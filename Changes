import requests
import os

def call_api_get_message(data):
    """
    Calls an API and returns the 'message' from the JSON response.

    Args:
        data (dict): The data to send in the API request.

    Returns:
        str: The 'message' from the API response, or an error message.
    """

    try:
        BASE_URL = "https://oa-dev2.ebiz.verizon.com/vegas/apps/autobi-retrieval"
        url = f"{BASE_URL}/process_document"
        api_key = os.environ.get('api_key')
        headers = {'X-apikey': api_key, 'Content-Type': 'application/json'}

        response = requests.post(url, headers=headers, json=data, verify=False)  # Consider removing verify=False in production

        response.raise_for_status()  # Raise HTTPError for bad responses (4xx or 5xx)

        return response.json()['message']

    except requests.exceptions.RequestException as e:
        return f"API call failed: {e}"
    except KeyError:
        return "Error: 'message' not found in API response."
    except Exception as e:
        return f"An unexpected error occurred: {e}"

# Example usage (assuming 'data' is defined)
# data = {"key": "value"}  # Replace with your actual data
# message = call_api_get_message(data)
# print(message)
